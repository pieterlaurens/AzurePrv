use prv_app_inh
DECLARE @api nvarchar(512) = 'CreateLandscape';
DECLARE @deployment_server sysname = 'nlagpdatacore'
DECLARE @RC int
DECLARE @projectid int = 007
DECLARE @projectkey nvarchar(100) = 'Impact'
DECLARE @solution nvarchar(255) = 'PRV'
DECLARE @runid int
DECLARE @json_sla nvarchar(max)
DECLARE @json_config nvarchar(max)
DECLARE @debug tinyint
SET @runid = 0

/* ================================================
	1. Set SLA settings
   ================================================ */
SET @projectkey = CONCAT(@projectkey, @solution, '_', @api, '_', @runid)
SET @json_sla = N'{"ComponentID": "D0E4F952-663C-42CA-89E8-318C931D42A9"
					, "RunID": "-1"
					, "PollEvery": "00:00:10"
					, "TimeOutAfter": "3600"
					, "PlatformDataSource": "nlagpdatacore"
					, "PlatformCatalog": "prv_app_inh"
					, "DatahandlerDataSource": "NLAGPDATACORE"
					, "DatahandlerCatalog": "prv_app_dth"
					, "DatahandlerVersion": "honeyrider"
					, "ProjectDataSource":"nlagpdatacore"
					, "ProjectCatalog":"prv_prj_trendimpact"
				}'

/* ================================================
	2. Set pipeline configuration
   ================================================ */
SET @json_config = N'{"Header":{
	"NameOfApi":"CreateImpactLandscape",
	"Creator":"sadejong@deloitte.nl",
	"ConfigurationDescription":"",
	"ConfigurationVersion":"",
	},"ComponentParams" : [ 
	{ "PackageName":"CreatePrepareEnvironment" }
	, { "PackageName":"SelectLandscapeNodes"
		,"NodeSelectionParams" :[
		{"NodeSelectionType" : "NodeList"
		, "NodeSelectionLabel" : "Food Node List"
		, "NodeList" : "A01B 01/02|A01B 01/06|A01B 01/16|A01B 01/20|A01B 01/22|A01B 01/24|A01B 03/02|A01B 03/04|A01B 03/24|A01B 03/36|A01B 03/46|A01B 03/50|A01B 03/64|A01B 03/74|A01B 05/00|A01B 07/00|A01B 09/00|A01B 11/00|A01B 13/00|A01B 15/00|A01B 17/00|A01B 19/02|A01B 19/08|A01B 19/10|A01B 21/00|A01B 23/00|A01B 25/00|A01B 27/005|A01B 29/00|A01B 31/00|A01B 33/00|A01B 35/00|A01B 37/00|A01B 39/00|A01B 41/00|A01B 43/00|A01B 45/00|A01B 47/00|A01B 49/00|A01B 51/02|A01B 51/04|A01B 59/00|A01B 61/00|A01B 63/00|A01B 67/00|A01B 69/00|A01B 71/00|A01B 73/00|A01B 75/00|A01B 76/00|A01B 77/00|A01B 79/00|A01C 01/005|A01C 01/02|A01C 01/04|A01C 01/06|A01C 01/08|A01C 03/00|A01C 05/00|A01C 07/00|A01C 09/00|A01C 11/00|A01C 13/00|A01C 14/00|A01C 15/00|A01C 17/00|A01C 19/00|A01C 21/00|A01C 23/00|A01D 01/02|A01D 01/04|A01D 01/06|A01D 01/08|A01D 01/14|A01D 03/00|A01D 05/00|A01D 07/00|A01D 09/00|A01D 11/00|A01D 15/00|A01D 17/00|A01D 19/00|A01D 21/00|A01D 23/00|A01D 25/00|A01D 27/00|A01D 29/00|A01D 31/00|A01D 33/00|A01D 34/001|A01D 34/006|A01D 34/01|A01D 34/835|A01D 37/00|A01D 39/00|A01D 41/00|A01D 42/00|A01D 43/00|A01D 44/00|A01D 45/00|A01D 46/00|A01D 47/00|A01D 51/00|A01D 57/01|A01D 57/12|A01D 57/14|A01D 57/16|A01D 57/18|A01D 57/20|A01D 57/22|A01D 57/24|A01D 57/26|A01D 57/28|A01D 57/30|A01D 59/00|A01D 61/00|A01D 63/00|A01D 65/00|A01D 67/00|A01D 69/00|A01D 75/00|A01D 76/003|A01D 76/006|A01D 78/00|A01D 80/00|A01D 82/00|A01D 84/00|A01D 85/00|A01D 87/00|A01D 89/00|A01D 90/00|A01D 91/00|A01D 93/00|A01F 01/02|A01F 01/04|A01F 01/06|A01F 03/00|A01F 07/00|A01F 11/00|A01F 12/00|A01F 15/00|A01F 17/02|A01F 17/04|A01F 19/00|A01F 21/00|A01F 25/00|A01F 29/00|A01G 01/001|A01G 01/002|A01G 2001/008|A01G 01/02|A01G 01/04|A01G 01/06|A01G 01/08|A01G 01/12|A01G 03/00|A01G 05/00|A01G 07/00|A01G 09/00|A01G 11/00|A01G 13/00|A01G 15/00|A01G 16/00|A01G 17/00|A01G 21/00|A01G 23/00|A01G 25/00|A01G 27/00|A01G 29/00|A01G 31/00|A01G 33/00|A01H 01/02|A01H 01/04|A01H 01/06|A01H 03/00|A01H 04/00|A01H 05/02|A01H 05/04|A01H 05/06|A01H 05/08|A01H 05/10|A01H 05/12|A01H 07/00|A01H 09/00|A01H 11/00|A01H 13/00|A01H 15/00|A01H 17/00|A01J 03/00|A01J 05/00|A01J 07/00|A01J 09/00|A01J 11/02|A01J 11/04|A01J 11/06|A01J 11/10|A01J 11/16|A01J 13/00|A01J 15/00|A01J 19/00|A01J 21/00|A01J 23/00|A01J 25/001|A01J 25/002|A01J 25/004|A01J 25/005|A01J 25/007|A01J 25/008|A01J 25/02|A01J 25/06|A01J 25/08|A01J 25/10|A01J 25/11|A01J 25/12|A01J 25/16|A01J 27/00|A01J 99/00|A01K 01/0005|A01K 01/0035|A01K 01/0041|A01K 01/0047|A01K 01/0088|A01K 01/0094|A01K 01/01|A01K 01/015|A01K 01/02|A01K 01/04|A01K 01/06|A01K 01/08|A01K 01/10|A01K 01/12|A01K 03/00|A01K 05/00|A01K 07/00|A01K 09/00|A01K 11/00|A01K 13/00|A01K 14/00|A01K 15/00|A01K 17/00|A01K 19/00|A01K 21/00|A01K 23/00|A01K 25/00|A01K 27/00|A01K 29/00|A01K 31/002|A01K 31/02|A01K 31/04|A01K 31/06|A01K 31/10|A01K 31/12|A01K 31/14|A01K 31/18|A01K 31/22|A01K 31/24|A01K 33/00|A01K 35/00|A01K 37/00|A01K 39/00|A01K 41/00|A01K 43/00|A01K 45/00|A01K 47/02|A01K 47/04|A01K 47/06|A01K 49/00|A01K 51/00|A01K 53/00|A01K 55/00|A01K 57/00|A01K 59/00|A01K 61/001|A01K 61/002|A01K 61/003|A01K 61/005|A01K 61/006|A01K 61/007|A01K 61/008|A01K 61/02|A01K 63/00|A01K 65/00|A01K 67/00|A01K 69/02|A01K 69/04|A01K 69/06|A01K 71/00|A01K 73/00|A01K 74/00|A01K 75/00|A01K 77/00|A01K 79/00|A01K 80/00|A01K 81/00|A01K 83/02|A01K 83/04|A01K 83/06|A01K 85/00|A01K 87/00|A01K 89/00|A01K 91/00|A01K 93/00|A01K 95/00|A01K 97/00|A01K 99/00|A01K 2207/05|A01K 2207/10|A01K 2207/12|A01K 2207/15|A01K 2207/20|A01K 2207/25|A01K 2207/30|A01K 2207/35|A01K 2217/00|A01K 2227/00|A01K 2267/00|A01L 01/02|A01L 01/04|A01L 03/00|A01L 05/00|A01L 07/00|A01L 09/00|A01L 11/00|A01L 13/00|A01L 15/00|A01M 01/02|A01M 01/06|A01M 01/08|A01M 01/10|A01M 01/14|A01M 01/20|A01M 01/22|A01M 01/24|A01M 03/00|A01M 05/00|A01M 07/00|A01M 09/00|A01M 11/00|A01M 13/00|A01M 15/00|A01M 17/00|A01M 19/00|A01M 21/00|A01M 23/00|A01M 25/00|A01M 27/00|A01M 29/00|A01M 31/00|A01M 99/00|A01M 2200/01|A01N 01/02|A01N 03/00|A01N 25/002|A01N 25/02|A01N 25/08|A01N 25/12|A01N 25/16|A01N 25/18|A01N 25/20|A01N 25/22|A01N 25/24|A01N 25/26|A01N 25/30|A01N 25/32|A01N 25/34|A01N 27/00|A01N 29/00|A01N 31/00|A01N 33/00|A01N 35/00|A01N 37/00|A01N 39/00|A01N 41/00|A01N 43/00|A01N 45/00|A01N 47/00|A01N 49/00|A01N 51/00|A01N 53/00|A01N 55/00|A01N 57/00|A01N 59/00|A01N 61/00|A01N 63/00|A01N 65/00|A21B 01/02|A21B 01/40|A21B 01/42|A21B 01/50|A21B 01/52|A21B 02/00|A21B 03/00|A21B 05/00|A21B 07/00|A21C 01/003|A21C 01/006|A21C 01/02|A21C 01/04|A21C 01/06|A21C 01/08|A21C 01/10|A21C 01/12|A21C 01/14|A21C 03/00|A21C 05/00|A21C 07/00|A21C 09/00|A21C 11/00|A21C 13/00|A21C 14/00|A21C 15/00|A21D 02/02|A21D 02/08|A21D 02/40|A21D 04/00|A21D 06/00|A21D 08/00|A21D 10/00|A21D 13/00|A21D 15/00|A21D 17/00|A22B 03/00|A22B 05/00|A22B 07/00|A22C 07/00|A22C 09/00|A22C 11/00|A22C 13/00|A22C 15/00|A22C 17/00|A22C 18/00|A22C 21/00|A22C 25/003|A22C 25/006|A22C 25/02|A22C 25/04|A22C 25/06|A22C 25/08|A22C 25/10|A22C 25/12|A22C 25/14|A22C 25/16|A22C 25/17|A22C 25/18|A22C 25/20|A22C 25/22|A22C 29/00|A23B 04/002|A23B 04/005|A23B 04/015|A23B 04/02|A23B 04/03|A23B 04/044|A23B 04/06|A23B 04/10|A23B 04/12|A23B 04/14|A23B 04/26|A23B 04/32|A23B 05/00|A23B 07/00|A23B 09/00|A23C 01/01|A23C 01/04|A23C 01/06|A23C 01/10|A23C 01/12|A23C 01/14|A23C 03/00|A23C 07/00|A23C 09/005|A23C 09/12|A23C 09/14|A23C 09/15|A23C 09/152|A23C 09/16|A23C 09/18|A23C 09/20|A23C 11/00|A23C 13/00|A23C 15/00|A23C 17/00|A23C 19/00|A23C 20/00|A23C 21/00|A23C 23/00|A23C 2210/00|A23C 2220/00|A23C 2230/00|A23C 2240/00|A23C 2250/00|A23C 2260/00|A23C 2270/00|A23D 07/001|A23D 07/003|A23D 07/005|A23D 07/01|A23D 07/015|A23D 07/02|A23D 07/06|A23D 09/00|A23F 03/06|A23F 03/16|A23F 03/34|A23F 03/36|A23F 03/40|A23F 05/00|A23G 01/0003|A23G 01/02|A23G 01/04|A23G 01/30|A23G 03/00|A23G 04/00|A23G 07/00|A23G 09/00|A23G 2200/02|A23G 2200/04|A23G 2200/06|A23G 2200/08|A23G 2200/10|A23G 2200/12|A23G 2200/14|A23G 2210/00|A23G 2220/00|A23J 01/001|A23J 01/006|A23J 01/008|A23J 01/009|A23J 01/02|A23J 01/04|A23J 01/06|A23J 01/08|A23J 01/10|A23J 01/12|A23J 01/14|A23J 01/16|A23J 01/18|A23J 01/20|A23J 03/00|A23J 07/00|A23K 01/001|A23K 01/006|A23K 01/02|A23K 01/04|A23K 01/06|A23K 01/08|A23K 01/10|A23K 01/12|A23K 01/14|A23K 01/16|A23K 01/18|A23K 01/22|A23K 03/00|A23L 01/0002|A23L 01/0005|A23L 01/0008|A23L 01/0011|A23L 01/0014|A23L 01/01|A23L 01/015|A23L 01/025|A23L 01/03|A23L 01/05|A23L 01/06|A23L 01/076|A23L 01/09|A23L 01/10|A23L 01/185|A23L 01/187|A23L 01/19|A23L 01/20|A23L 01/212|A23L 01/22|A23L 01/27|A23L 01/28|A23L 01/29|A23L 01/31|A23L 01/32|A23L 01/325|A23L 01/36|A23L 01/39|A23L 01/48|A23L 02/00|A23L 03/00|A23N 01/003|A23N 01/006|A23N 01/02|A23N 03/00|A23N 04/00|A23N 05/00|A23N 07/00|A23N 11/00|A23N 12/00|A23N 15/00|A23N 17/00|A23P 01/005|A23P 01/02|A23P 01/04|A23P 01/06|A23P 01/08|A23P 01/10|A23V 2200/00|A23V 2250/00|A23V 2300/00|A23Y 2220/03|A23Y 2220/05|A23Y 2220/07|A23Y 2220/09|A23Y 2220/13|A23Y 2220/15|A23Y 2220/17|A23Y 2220/19|A23Y 2220/21|A23Y 2220/23|A23Y 2220/25|A23Y 2220/27|A23Y 2220/29|A23Y 2220/31|A23Y 2220/33|A23Y 2220/35|A23Y 2220/37|A23Y 2220/39|A23Y 2220/41|A23Y 2220/43|A23Y 2220/45|A23Y 2220/47|A23Y 2220/49|A23Y 2220/51|A23Y 2220/53|A23Y 2220/61|A23Y 2220/63|A23Y 2220/65|A23Y 2220/67|A23Y 2220/69|A23Y 2220/71|A23Y 2220/73|A23Y 2220/75|A23Y 2220/77|A23Y 2220/79|A23Y 2220/81|A23Y 2220/83|A23Y 2220/85|A23Y 2240/00|A23Y 2260/00|A23Y 2280/00|A23Y 2300/00|A23Y 2320/00|C05B 01/02|C05B 01/04|C05B 01/06|C05B 01/10|C05B 03/00|C05B 05/00|C05B 07/00|C05B 09/00|C05B 11/00|C05B 13/00|C05B 15/00|C05B 17/00|C05B 19/00|C05C 01/02|C05C 03/00|C05C 05/00|C05C 07/00|C05C 09/00|C05C 11/00|C05D 01/005|C05D 01/02|C05D 01/04|C05D 03/00|C05D 05/00|C05D 07/00|C05D 09/00|C05F 01/002|C05F 01/005|C05F 01/007|C05F 01/02|C05F 03/00|C05F 05/00|C05F 07/00|C05F 09/00|C05F 11/00|C05F 17/00|C05G 03/00|C07K 01/003|C07K 01/006|C07K 01/02|C07K 01/04|C07K 01/06|C07K 01/10|C07K 01/107|C07K 01/12|C07K 01/13|C07K 01/14|C07K 02/00|C07K 04/00|C07K 05/00|C07K 07/00|C07K 09/00|C07K 11/00|C07K 14/00|C07K 16/00|C07K 17/00|C07K 19/00|C07K 2316/00|C07K 2317/00|C07K 2318/00|C07K 2319/00|C08B 01/003|C08B 01/006|C08B 01/02|C08B 01/06|C08B 01/08|C08B 03/00|C08B 05/00|C08B 07/00|C08B 09/00|C08B 11/00|C08B 13/00|C08B 15/00|C08B 16/00|C08B 17/00|C08B 30/00|C08B 31/00|C08B 33/00|C08B 35/00|C08B 37/00|C11B 01/02|C11B 01/06|C11B 01/10|C11B 01/12|C11B 03/00|C11B 05/00|C11B 07/00|C11B 09/00|C11B 11/00|C11B 13/00|C11B 15/00|C12H 01/003|C12H 01/02|C12H 01/12|C12H 01/22|C12J 01/02|C12J 01/04|C12J 01/06|C12J 01/08|C12J 01/10|C12N 01/005|C12N 01/02|C12N 01/04|C12N 01/06|C12N 01/08|C12N 01/10|C12N 01/12|C12N 01/14|C12N 01/20|C12N 01/22|C12N 01/24|C12N 01/26|C12N 01/32|C12N 01/34|C12N 01/36|C12N 01/38|C12N 03/00|C12N 05/00|C12N 07/00|C12N 09/00|C12N 11/00|C12N 13/00|C12N 15/00|C12N 2310/00|C12N 2320/00|C12N 2330/00|C12N 2500/00|C12N 2501/00|C12N 2502/00|C12N 2503/00|C12N 2506/00|C12N 2509/00|C12N 2510/00|C12N 2511/00|C12N 2513/00|C12N 2517/00|C12N 2521/00|C12N 2523/00|C12N 2525/00|C12N 2527/00|C12N 2529/00|C12N 2531/00|C12N 2533/00|C12N 2535/00|C12N 2537/00|C12N 2539/00|C12N 2700/00|C12N 2710/00|C12N 2720/00|C12N 2730/00|C12N 2740/00|C12N 2750/00|C12N 2760/00|C12N 2770/00|C12N 2780/00|C12N 2790/00|C12N 2792/00|C12N 2795/00|C12N 2799/00|C12N 2800/00|C12N 2810/00|C12N 2820/00|C12N 2830/00|C12N 2840/00|C12N 2999/00|C12R 01/01|C12R 01/645|C12R 01/89|C12R 01/90|C12R 01/91"
		}
		] }
	, { "PackageName":"ScoreLandscapeNodes"
		, "ScoreLandscapeNodesParams" :[{
		"ScoringType" : "CompanyPortfolio"
		, "ScoreGroup" : "Relevance"
		, "SeriesGroup" : "Relevant Companies"
		, "Normalize" : "None"
		, "CompanyId" : "CHCHE109815753|GB00041424|NL27090548"
		},{
		"ScoringType" : "CompanyPortfolio"
		, "ScoreGroup" : "Weight"
		, "SeriesGroup" : "Relevant Companies"
		, "Normalize" : "Class"
		, "CompanyId" : "CHCHE109815753|GB00041424|NL27090548"
		},{
		"ScoringType" : "BagOfWords"
		, "ScoringLabel" : "Food"
		, "ScoreGroup" : "Relevance"
		, "SeriesGroup" : "Strategic area"
		, "Normalize" : "None"
		, "BagOfWords" : "food"
		},{
		"ScoringType" : "BagOfWords"
		, "ScoringLabel" : "Food"
		, "ScoreGroup" : "Weight"
		, "SeriesGroup" : "Strategic area"
		, "Normalize" : "Class"
		, "BagOfWords" : "food"
		},{
		"ScoringType" : "BagOfWords"
		, "ScoringLabel" : "Agriculture"
		, "ScoreGroup" : "Relevance"
		, "SeriesGroup" : "Strategic area"
		, "Normalize" : "None"
		, "BagOfWords" : "agri*"
		},{
		"ScoringType" : "BagOfWords"
		, "ScoringLabel" : "Agriculture"
		, "ScoreGroup" : "Weight"
		, "SeriesGroup" : "Strategic area"
		, "Normalize" : "Class"
		, "BagOfWords" : "agri*"
		}]
		}
	, { "PackageName":"GetNodeProperties"
		, "GetNodePropertiesParams" :[
		{"PropertyLabel" : "Label"
		, "PropertyMethod" : "TechnologyClassLabel"
		},{"PropertyLabel" : "Extended Label"
		, "PropertyMethod" : "TechnologyClassExtendedLabel"
		},{"PropertyLabel" : "Size"
		, "PropertyMethod" : "TechnologyClassSize"
		},{"PropertyLabel" : "Trend"
		, "PropertyMethod" : "TechnologyTrendRelativeToLandscape"
		},{"PropertyLabel" : "Technology Class"
		, "PropertyMethod" : "NodeId"
		},{"PropertyLabel" : "High Level Label"
		, "PropertyMethod" : "HighLevelTechnologyLabel"
		, "PropertyParameters" : "A01:Agriculture|A2:Foodstuffs|C05:Fertilizers|C07K:Peptides|C08B:Polysacharides|C11B:Fats and oils|C12:Enzymology and microbiology"
		} ] }
	, { "PackageName":"CalculateLandscapeDistances" }
	, {"PackageName":"ApproximateDistanceIn2D"
		, "NormalizeDistance" : "none"
		, "RandomSeed" : 0
		, "MaxIterations" : 100
		, "Algorithm" : "MatlabMds"
		} 
	, { "PackageName":"PrepareForVisualization" }
	]}' 

/* ================================================
	3. Launch pipeline
   ================================================ */
EXECUTE @RC = [ivh].[run_createNewRun] 
   @projectid = @projectid
  ,@projectkey = @projectkey
  ,@solution = @solution
  ,@api = @api
  ,@runid = @runid
  ,@json_sla = @json_sla
  ,@json_config = @json_config
  ,@debug = 1
GO


-----------------------
/* GET log/event INFORMATION */
-----------------------
SELECT TOP 1000 *
  FROM [nlh].[log]
  WHERE source_name <> 'PackageTemplate.dtsx'
  ORDER BY added_on DESC

SELECT TOP 1000 *
  FROM [nlh].[event]
  ORDER BY added_on DESC